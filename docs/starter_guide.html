<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" >
    <meta name="viewport" content="width=device-width, target-densitydpi=device-dpi, initial-scale=1, maximum-scale=1, user-scalable=yes">
    <meta charset="UTF-8">

    <!-- polyfills -->
    <script src="bower_components/webcomponentsjs/webcomponents-loader.js"></script>

    <script src="js/preload.js"></script>
    <script src="js/monaco-customize.js"></script>
    <script src="js/monaco-hover-utils.js" type="text/javascript"></script>

    <!-- API Documentation -->
    <script src="node_modules/jsonlint/lib/jsonlint.js"></script>
    <script src="node_modules/codemirror/lib/codemirror.js"></script>
    <script src="node_modules/codemirror/addon/mode/loadmode.js"></script>
    <script src="node_modules/codemirror/mode/meta.js"></script>
    <!-- Some basic syntax highlighting -->
    <script src="node_modules/codemirror/mode/javascript/javascript.js"></script>
    <script src="node_modules/codemirror/mode/xml/xml.js"></script>
    <script src="node_modules/codemirror/mode/htmlmixed/htmlmixed.js"></script>
    <script src="node_modules/codemirror/addon/lint/lint.js"></script>
    <script src="node_modules/codemirror/addon/lint/json-lint.js"></script>
    <script src="node_modules/marked/lib/marked.js"></script>
    <script type="module">
      import './web_modules/@api-components/api-documentation.js';
    </script>
    <!-- /API Documentation -->

    <link rel="stylesheet" href="bower_components/bulma/css/bulma.css">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="bower_components/font-awesome/css/all.min.css">
    <link rel="stylesheet" href="bower_components/balloon-css/balloon.css">
    <link rel="stylesheet" href="bower_components/jointjs/dist/joint.css">
    <title>Starter Guide</title>
</head>
<body>
<!-- Loader view -->
<div id="preloader" class="container is-marginless is-fluid" style="background-color: white; top:0; position: absolute; width: 100%; height: 100%; text-align: center; padding-top: 13%; z-index: 1000">
    <h2 class="title is-2">Loading Demo: Starter Guide</h2>
    <progress id="preloader-progress" class="progress is-info" value="0" max="100" style="margin-left: 25%; max-width: 50%">0%</progress>
</div>


<!-- Load RAML File modal -->
<link rel="import" href="html_fragments/load_modal.html">
<!-- Nav -->
<link rel="import" href="html_fragments/starter_guide/nav.html">

<!-- Main container class -->
<div class="section" style="padding: 0px">
    <div id="the-app" class="container is-marginless is-fluid">
        <div class="columns">
            <div class="column">
                <link rel="import" href="html_fragments/starter_guide/editor.html">
                <div id="api-console-container">
                  <api-documentation noTryIt="true" noBottomNavigation="true">
                  </api-documentation>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
  (function() {
    window.global = window;
    // ************
    // $URL will be replaced by the URL passed to the AMF requests
    // to form the final URL for the invocation throught the proxy
    // window.JS_USE_PROXY="https://mycorsproxy.com/$URL";
    // ************
    var loadApp = function(cb) {
      var assets = [
        "js/starter_guide.js",
        "js/monaco-editor/min/vs/loader.js"
      ];
      var loaded = 0;
      var preload = new createjs.LoadQueue();
      var handleFileComplete = function(event) {
        var oldValue = document.getElementById("preloader-progress").value;
        var newValue = Math.floor(oldValue + (100 / (loaded + assets.length)));
        document.getElementById("preloader-progress").value = newValue;
        document.body.appendChild(event.result);
        loaded++;
        if (assets.length == 0) {
          document.getElementById("preloader-progress").value = 100;
          cb();
        } else {
          console.log("loading " + assets[0]);
          preload.loadFile(assets.shift());
        }
      };
      preload.addEventListener("fileload", handleFileComplete);
      console.log("loading " + assets[0]);
      preload.loadFile(assets.shift());
    };

    window.addEventListener('WebComponentsReady', function() {
      document.getElementsByName("body");
      // Imported content
      window.reloadApp = function() {
        var importedMap = {};
        var pending = true;
        while (pending === true) {
          pending = false;
          var links = document.querySelectorAll('link[rel="import"]');
          for (var i = 0; i < links.length; i++) {
            var link = links[i];
            if (link.import != null && importedMap[link.href] == null) {
              pending = true;
              importedMap[link.href] = true;
              var content = link.import;
              var el = content.querySelector('.imported');
              if (el) {
                link.parentNode.insertBefore(el.cloneNode(true), link);
              }
            }
          }
        }

        require.config({
          paths: {
            'vs': 'js/monaco-editor/min/vs'
          }
        });
        require(['vs/editor/editor.main'], function() {
          var resize = function() {
            var height = document.documentElement.clientHeight;
            var containersIds = ["editor-container-raml"];
            containersIds.forEach(id => {
              var container = document.getElementById(id);
              var offset = container.getBoundingClientRect().top + 20;
              container.setAttribute("style", "height: " + (height - offset) + "px");
            })
            var container = document.getElementById("api-console-container");
            var offset = container.getBoundingClientRect().top + 40;
            container.setAttribute("style", "height: " + (height - offset) + "px");

          }
          window.onresize = resize;
          window.resizeFn = resize;
          resize();

          customizeMonaco();

          monaco.editor.defineTheme('ramlTheme', {
            base: 'vs-dark', // vs, hc-black, vs-dark
            inherit: true,
            rules: [{ background: 'EDF9FA' },
                {token : 'type', foreground: "#26d3ff"},
                {token : 'special', foreground:'#BDB7F4'},
                {token : 'string', foreground: '#00b3de'},
                {token : 'keyword', foreground: '#cccccc'},
                {token : 'number', foreground: '#bdf1a3'},
                {token : 'syntaxTag', foreground: '#9dd288'},
                {token : 'tag', foreground: '#9dd288'},
                {token : 'rootComment', foreground: '#9dd288'},

                {token : 'methodGET', foreground: '#33B333'},
                {token : 'methodPOST', foreground: '#2196F3'},
                {token : 'methodPATCH', foreground: '#CF5AE3'},
                {token : 'methodDELETE', foreground: '#FF7669'},
                {token : 'methodOther', foreground: '#9A9A9A'}
              ],
            colors: {
              'editor.foreground': '#000000',
              'editor.background': '#3c4c5f',
              'editor.lineHighlightBackground': '#222b35',
              'editor.lineHighlightForeground': '#222b35',
              'editor.selectionBackground': '#222b35',
              'editor.selectionForeground': '#222b35',
              'editor.selectionHighlightBackground': '#222b35',
              'editor.selectionHighlightForeground': '#222b35',
              'editor.inactiveSelectionBackground': '#222b35',
              'editor.hoverHighlightBackground': '#222b35',
              'editor.hoverHighlightForeground': '#222b35',
              'editorCursor.foreground': '#8B0000',
              'editorLineNumber.foreground': '#008800',
              'input.background': '#FFFFFF',
              'editorHoverWidget.background': '#F7FAFF',
              'editorHoverWidget.border': '#222b35',
              'editorIndentGuide.background': '#9EAAB7'
            }
          });
          monaco.editor.setTheme('ramlTheme');

          var ramlEditor = monaco.editor
            .create(document.getElementById("editor-container-raml"), {
              value: '',
              language: 'raml',
              automaticLayout: true,
              scrollBeyondLastLine: false,
              renderLineHighlight: "none",
              occurrencesHighlight: false,
              minimap: {
                enabled: false
              }
            });
          ramlEditor.getModel().updateOptions({ tabSize: 2 });

          hoverUtils.loadLanguages('json', 'xml', 'yaml')
          monaco.languages.registerLinkProvider('raml', {
            provideLinks: (m, t) => hoverUtils.provideLinks(m, t)
          })

          window.appModel = new starter_guide.ViewModel(ramlEditor);
          window.appModel.apply();
          window.appModel.loadRamlFromQueryParam();
          window.appModel.loadInitialDocument();

          monaco.languages.registerHoverProvider('raml', {
            provideHover: (m, p) => {
              window.appModel.apiConsole.switchSelected(p)
              return hoverUtils.provideHover(m, p)
            }
          });

          setTimeout(function() {
            document.getElementById("preloader").style.display = "none";
            var brand = document.getElementById("brand");
            if (brand) {
              brand.style.display = 'block';
            }
          }, 200);
        });
      };

      loadApp(function() {
        reloadApp();
      });
    });
  })();
</script>
</body>
</html>